<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.3.1/css/select.dataTables.min.css">

    <title>Anime Site</title>
  </head>
  <body style="background-color:mintcream">


<!-- Modal -->
<div class="modal fade bd-example-modal-lg" id="animeModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        
        <div class="row py-md-3">

            <div class="col-sm-4">
             <div class="card bg-light">
               <div class="card-header">Current Score</div>
               <div css="card-body">
                  <canvas id="currentScore" height="60"></canvas>
               </div>
              </div>
            </div>

            <div class="col-sm-4">
                <div class="card bg-light">
                  <div class="card-header">Current Status</div>
                  <div css="card-body">
                     <canvas id="currentStatus" height="60"></canvas>
                  </div>
                 </div>
               </div>

               <div class="col-sm-4">
                <div class="card bg-light">
                  <div class="card-header">Episodes Watched</div>
                  <div css="card-body">
                    <canvas id="currentEpisodes" height="60"></canvas>
                  </div>
                 </div>
               </div>
        </div>
      
        
        <form>

          <div class="form-group">

            <div class="input-group mb-3">

              <div class="input-group-prepend">

                <label class="input-group-text" for="inputGroupSelect01">Status:</label>

              </div>

              <select class="custom-select" id="inputGroupSelect01">

                <option value="0">None</option>
                <option value="1">Currently Watching</option>
                <option value="2">Completed</option>
                <option value="3">On Hold</option>
                <option value="4">Drop</option>
                <option value="6">Plan To Watch</option>


              </select>
              
            </div>

          </div>

          <div class="form-group">

            <div class="input-group mb-3">

              <div class="input-group-prepend">

                <span class="input-group-text">Episodes Watched:</span>

              </div>

                <input type="text" class="form-control" id="epText" autocomplete="off"> 

              <div class="input-group-append">

                <span class="input-group-text" id="outOf">/00</span>

              </div>

            </div>
            
          </div>

          <div class="form-group">

            <div class="input-group mb-3">

              <div class="input-group-prepend">

                <span class="input-group-text">Score:</span>

              </div>

                <input type="text" class="form-control" id="scoreText" autocomplete="off">

              <div class="input-group-append">

                <span class="input-group-text">/10</span>

              </div>

            </div>

          </div>
          

        </form>
    



      </div>
      <div class="modal-footer">

        <button type="button" class="btn btn-primary" id="btnAdd">Update</button>
        <button type="button" class="btn btn-danger" id="btnRemove">Remove</button>

      </div>
    </div>
  </div>
</div>
<!-- TESTING -->

<div class="container mb-3 mt-3">
    <table id="example" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>Title</th>
                <th>Rank</th>
                <th>Type</th>
                <th>Episodes Watched</th>
                <th>Score</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
            <tr>
                <th>Title</th>
                <th>Rank</th>
                <th>Type</th>
                <th>Episodes Watched</th>
                <th>Score</th>
                <th>Status</th>
            </tr>
        </tfoot>
    </table>

    <button type="button" class="btn btn-success" id="btnSelect">Select</button>
    <button type="button" class="btn btn-warning" id="sAgain">Profile</button>

</div>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper)
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    -->


    <!-- Option 2: jQuery, Popper.js, and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    

    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"></script>

    
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>

    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>

    <!--Testing-->
    
    
    <script>
    
      var showIndex = -99;
      var show;

      var m1 = document.getElementById("currentScore");
      var c1 = m1.getContext("2d");
      c1.font = "30px Helvetica";

      var m2 = document.getElementById("currentStatus");
      var c2 = m2.getContext("2d");
      c2.font = "20px Helvetica";
      
      var m3 = document.getElementById("currentEpisodes");
      var c3 = m3.getContext("2d");
      c3.font = "30px Helvetica";



      //what happens as soon as page loads
      $(document).ready(function()
      {
              //Get the global variable 
              var searchID = sessionStorage.getItem("curID");
              var input = {id: searchID};


          $.ajax({
              //Post data query work
              type: 'POST',
              url: '/mylist.html/days',
              data: input,
    
                  success: function(data){
                      
                    var table = $('#example').DataTable({
                        data: data,
                        select: true
                    });

                    table.on( 'select', function ( e, dt, type, indexes ){
                            var sRowData = indexes;
                            //window.alert(rowData);

                            setIndex(sRowData);
                        })

                    table.on( 'deselect', function ( e, dt, type, indexes ){
                            var dRowData = -1;
                            //window.alert(rowData);

                            setIndex(dRowData);
                        })

                        setShow(data);

                  }
              });
      });

      function setIndex(i)
      {
        showIndex = i;
      }

      function setShow(d)
      {
        show = d;
      }


      document.getElementById("btnSelect").addEventListener("click", function(){

            
            //console.log(showIndex);

            current = show[showIndex];
            var showEpNum = current[6];

            $("#animeModal").modal();
            document.getElementById("modalTitle").innerHTML = current[0];
            document.getElementById("outOf").innerHTML = "/" + showEpNum;

            c1.fillText("          " + current[4],10,50);
            c2.fillText("    " + current[5],10,50);
            c3.fillText("          " + current[3],10,50);

        });

        document.getElementById("sAgain").addEventListener("click", function(){

          window.location.href = "/profile.html"
        });


        function listRemove(mA, mB)
        {
            var mAa = mA;
            var mBb = mB;

            var input = {a: mAa, b: mBb};

            $.ajax({
              
              type: 'POST',
              url: '/mylist.html/weeks',
              data: input,
    
                  success: function(data){
                      
                    //alert(data);
                    console.log(data);

                  }
              });


        }

        document.getElementById("btnRemove").addEventListener("click", function(){


            var mShow = show[showIndex]; //Get Show Title
            var mUser = sessionStorage.getItem("curID"); //Get User ID

            listRemove(mShow[0], mUser);


            $('#animeModal').modal('hide');
            alert("Show Removed From List!");
            //location.reload()
        });

    
        function searchInsert(mA, mB, mC, mD, mE)
        {
            var mAa = mA;
            var mBb = mB;
            var mCc = mC;
            var mDd = mD;
            var mEe = mE;

            var input = {a: mAa, b: mBb, c: mCc, d: mDd, e: mEe};


            $.ajax({
              
              type: 'POST',
              url: '/search.html/weeks',
              data: input,
    
                  success: function(data){
                      
                    //alert(data);
                    console.log(data);

                  }
              });
        }

        document.getElementById("btnAdd").addEventListener("click", function(){

          var s = document.getElementById("inputGroupSelect01");

          var mShow = show[showIndex]; //Get Show Title
          var mStatus = s.options[s.selectedIndex].value; //Get Show Status
          var mEpisodes = document.getElementById("epText").value; //Get Show Episodes
          var mScores = document.getElementById("scoreText").value; //Get Show Score
          var mUser = sessionStorage.getItem("curID"); // Get User ID

          //console.log("Anime Title: " + mShow[0]);
          //console.log("User ID: " + mUser);
          //console.log("Status: " + mStatus);
          //console.log("Episodes: " + mEpisodes);
          //console.log("Score: " + mScores);

          searchInsert(mShow[0], mUser, mStatus, mEpisodes, mScores);

            $('#animeModal').modal('hide');
            alert("Show Was Updated!");
            //location.reload()
            //window.location.href = "/mylist.html"

          });
        
          $('#animeModal').on('hidden.bs.modal', function (e) {
            console.log("Cleaned");

            $(this).find('form').trigger('reset');

            c1.clearRect(0, 0, m1.width, m1.height);
            c2.clearRect(0, 0, m3.width, m2.height);
            c3.clearRect(0, 0, m3.width, m3.height);

          })

      </script>
  </body>
</html>